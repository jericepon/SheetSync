<!DOCTYPE html>
<html>
  <head>
    <title>Import CSV</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      /* @font-face {
        font-family: "Dank Mono";
        src: url("DankMono-Regular.ttf") format("truetype");
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }

      @font-face {
        font-family: "Dank Mono";
        src: url("DankMono-Italic.ttf") format("truetype");
        font-weight: normal;
        font-style: italic;
        font-display: swap;
      } */

      :root {
        font-family: "Dank Mono", monospace;
        line-height: 1.5;
        font-weight: 400;

        color-scheme: light dark;
        color: rgba(255, 255, 255, 0.87);
        background-color: #242424;

        font-synthesis: none;
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      body {
        display: flex;
        padding: 26px;
        flex-direction: column;
        gap: 26px;
      }

      button {
        border-radius: 8px;
        border: 1px solid transparent;
        padding: 0.6em 1.2em;
        font-size: 1em;
        font-weight: 500;
        font-family: inherit;
        background-color: #1a1a1a;
        cursor: pointer;
        transition: border-color 0.25s;
      }
      button:hover {
        border-color: #646cff;
      }
      button:focus,
      button:focus-visible {
        outline: 4px auto -webkit-focus-ring-color;
      }

      #csv {
        border-radius: 8px;
        padding: 8px;
      }

      #or-divider {
        text-align: center;
      }
      /* @media (prefers-color-scheme: dark) {
        :root {
          color: #213547;
          background-color: #ffffff;
        }
        a:hover {
          color: #747bff;
        }
        button {
          background-color: #f9f9f9;
        }
      } */
    </style>
  </head>
  <body>
    <h3>SheetSync</h3>

    <div>
      <label>
        <input type="checkbox" id="hugCheckbox" />
        Hug contents
      </label>
    </div>

    <div id="loading" style="display: none">Loadingâ€¦</div>

    <input type="file" id="csvFile" accept=".csv" />

    <div id="or-divider">or</div>

    <textarea
      id="csv"
      placeholder="Paste CSV here..."
      style="width: 100%; height: 120px"
    ></textarea>

    <button id="generate">Import</button>
    <script type="module" src="./src/main.ts"></script>
    <script>
      let csvText;
      const generateButton = document.getElementById("generate");
      const hugCheckbox = document.getElementById("hugCheckbox");
      const csvFile = document.getElementById("csvFile");

      csvFile.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = () => {
          csvText = reader.result;
        };
        reader.readAsText(file);
      });

      document.getElementById("generate").onclick = () => {
        const csv = csvText;
        const hugContents = hugCheckbox.checked;

        // parent.postMessage({ pluginMessage: { type: "get-csv", csv } }, "*");
        parent.postMessage({ pluginMessage: { type: "get-csv", csv, hugContents } }, "*");
      };

      // Loading state
      window.onmessage = (event) => {
        const msg = event.data.pluginMessage;
        if (msg.type === "loading") {
          document.getElementById("loading").style.display = msg.status ? "block" : "none";
        }
      };
    </script>
  </body>
</html>
